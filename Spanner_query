SELECT
    p.PROVIDER_IDENTIFICATION_NBR,
    p.NETWORK_ID,
    p.SERVICE_LOCATION_NBR,
    p.SPECIALTY_CD,
    p.PROVIDER_TYPE_CD,
    r.SERVICE_CD,
    r.SERVICE_TYPE_CD,
    r.PLACE_OF_SERVICE_CD,
    r.PRODUCT_CD,
    r.PROVIDER_BUSINESS_GROUP_NBR,
    r.ZIP_CODE_UN,
    r.RATE,
    r.PAYMENT_METHOD_CD,
    r.CONTRACT_TYPE
FROM CET_PROVIDERS p
JOIN CET_RATES r
    ON p.PROVIDER_BUSINESS_GROUP_NBR = r.PROVIDER_BUSINESS_GROUP_NBR
where 



SELECT 
    PROVIDER_BUSINESS_GROUP_NBR,
    COUNT(DISTINCT PAYMENT_METHOD_CD) AS payment_method_count
FROM 
    CET_RATES
GROUP BY 
    PROVIDER_BUSINESS_GROUP_NBR
HAVING 
    COUNT(DISTINCT PAYMENT_METHOD_CD) > 1;


SELECT 
  PROVIDER_BUSINESS_GROUP_NBR,
  PAYMENT_METHOD_CD,
FROM 
  CET_RATES
WHERE 
  PROVIDER_BUSINESS_GROUP_NBR IN (
    SELECT 
      PROVIDER_BUSINESS_GROUP_NBR
    FROM 
      CET_RATES
    GROUP BY 
      PROVIDER_BUSINESS_GROUP_NBR
    HAVING 
      COUNT(DISTINCT PAYMENT_METHOD_CD) > 1
  )
LIMIT 100;


SELECT 
    PROVIDER_BUSINESS_GROUP_NBR,
    SERVICE_CD,
    SERVICE_TYPE_CD,
    PRODUCT_CD,
    STRING_AGG(DISTINCT PAYMENT_METHOD_CD, ', ') AS payment_methods,
    COUNT(DISTINCT PAYMENT_METHOD_CD) AS payment_method_count
FROM 
    CET_RATES
GROUP BY 
    PROVIDER_BUSINESS_GROUP_NBR,
    SERVICE_CD,
    SERVICE_TYPE_CD,
    PRODUCT_CD
HAVING 
    COUNT(DISTINCT PAYMENT_METHOD_CD) > 1
ORDER BY 
    PROVIDER_BUSINESS_GROUP_NBR,
    SERVICE_CD
LIMIT 100;
